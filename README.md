# 镜像投毒攻击检测

## 目录
- [镜像投毒攻击检测](#镜像投毒攻击检测)
  - [目录](#目录)
  - [1. 项目概述](#1-项目概述)
    - [1.1 典型的镜像投毒方式](#11-典型的镜像投毒方式)
    - [1.2 危害](#12-危害)
    - [1.3 防御措施](#13-防御措施)
  - [2. 镜像样本](#2-镜像样本)
  - [3. 投毒方法](#3-投毒方法)
    - [3.1 获取被投毒镜像](#31-获取被投毒镜像)

## 1. 项目概述
 "镜像投毒"通常指在使用容器技术（如 Docker、Kubernetes 等）时，攻击者通过投放或篡改容器镜像来实现恶意行为。被污染的镜像可能包含恶意代码、后门、或者被篡改的依赖库，从而威胁使用这些镜像的系统和环境的安全。

### 1.1 典型的镜像投毒方式
1. 恶意镜像上传：攻击者将恶意镜像上传到公共镜像仓库（如 Docker Hub），诱导用户下载和使用。
2. 合法镜像篡改：攻击者通过劫持供应链攻击（Supply Chain Attack），对合法镜像进行篡改。
3. 镜像依赖篡改：修改镜像中包含的依赖包或脚本，注入恶意代码。
4. 冒名顶替镜像：发布与合法镜像名称极为相似的恶意镜像，诱导用户误下载。

### 1.2 危害
- 数据泄露：镜像中的后门程序可能窃取系统或用户敏感数据。
- 资源滥用：恶意镜像可能运行加密货币挖矿程序，导致资源浪费。
- 权限提升：通过恶意镜像中的漏洞或后门程序，攻击者可能获得宿主机的权限。
- 横向移动：攻击者可能通过容器内部漏洞，扩展攻击范围至其他容器或宿主机。

### 1.3 防御措施
1. 镜像来源验证：
    - 仅从可信的镜像仓库下载镜像。
    - 使用官方镜像或经过数字签名的镜像。    
2. 镜像扫描：
    - 在使用镜像前，使用安全扫描工具（如 Docker 的 docker scan 或第三方工具）检测镜像中的漏洞和恶意代码。
3. 最小化镜像权限：
    - 运行容器时避免使用高权限账户（如 root）。
    - 使用最小化的基础镜像，减少攻击面。
4. 定期更新镜像：
    - 使用最新版本的镜像和依赖包，避免使用过时且存在漏洞的镜像。
5. 供应链安全：
    - 在构建镜像时对所有依赖包进行安全检查。
    - 配置 CI/CD 安全检查流程，防止恶意代码注入。
6. 启用容器运行时安全策略：
    - 使用工具（如 SELinux、AppArmor、或 seccomp）限制容器行为。
    - 启用镜像签名验证功能（如 Docker Content Trust）。

## 2. 镜像样本
选取了docker hub 官方下载量前20的镜像，并将每种镜像的latest版本下载到本地仓库中。镜像信息如下表所示。

| 序号 | 镜像 | 功能 |
|:---:|:---:|:---:|
| 1 | memcached | 分布式内存对象缓存系统 |
| 2 | nginx | Web服务器和反向代理服务器 |
| 3 | busybox | Linux工具箱 |
| 4 | ubuntu | Linux操作系统发行版 |
| 5 | redis | 开源内存数据存储系统 |
| 6 | postgres | 开源对象关系数据库系统 |
| 7 | python | Python编程语言环境 |
| 8 | node | JavaScript运行时环境 |
| 9 | mongo | 开源文档数据库 |
| 10 | mysql | 关系型数据库管理系统 |
| 11 | rabbitmq | 开源消息队列中间件 |
| 12 | mariadb | MySQL的开源分支数据库 |
| 13 | openjdk | Java开发环境 |
| 14 | golang | Go编程语言环境 |
| 15 | ruby | Ruby编程语言环境 |
| 16 | wordpress | 开源内容管理系统 |
| 17 | debian | Linux操作系统发行版 |
| 18 | php | PHP编程语言环境 |
| 19 | centos | Linux操作系统发行版 |
| 20 | tomcat | Java Web应用服务器 |

## 3. 投毒方法
### 3.1 获取被投毒镜像
遍历本地镜像仓库，针对步骤2下载的每个镜像`image`，使用以下命令启动一个名为`base`的 容器，并在其中执行恶意软件，运行10s后，使用docker commit 命令将容器提交为新的镜像`image_elf`。
































